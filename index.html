<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simple Firebase Quiz App</title>
  <style>
    body { font-family: system-ui, Arial; max-width:900px; margin:24px auto; padding:12px; }
    .card { border:1px solid #ddd; padding:16px; border-radius:8px; margin-bottom:12px; }
    input, button, textarea { font-size:16px; padding:8px; margin:6px 0; width:100%; box-sizing:border-box }
    .row { display:flex; gap:8px }
    .row > * { flex:1 }
    .hidden { display:none }
    nav { display:flex; gap:8px; margin-bottom:12px }
    nav button { width:auto }
    .question { margin:8px 0 }
  </style>
</head>
<body>
  <h1>Simple Firebase Quiz App</h1>  <nav>
    <button id="btn-show-register">Register</button>
    <button id="btn-show-login">Login</button>
    <button id="btn-show-profile" class="hidden">Profile</button>
    <button id="btn-show-quiz" class="hidden">Take Quiz</button>
    <button id="btn-logout" class="hidden">Logout</button>
  </nav>  <div id="auth-area">
    <div id="register-card" class="card hidden">
      <h3>Register</h3>
      <input id="reg-email" placeholder="Email" />
      <input id="reg-password" placeholder="Password (6+ chars)" type="password" />
      <input id="reg-name" placeholder="Full name" />
      <button id="btn-register">Create account</button>
      <div id="reg-msg"></div>
    </div><div id="login-card" class="card hidden">
  <h3>Login</h3>
  <input id="login-email" placeholder="Email" />
  <input id="login-password" placeholder="Password" type="password" />
  <button id="btn-login">Login</button>
  <div id="login-msg"></div>
</div>

  </div>  <div id="profile-card" class="card hidden">
    <h3>Your Profile</h3>
    <div><strong>Email:</strong> <span id="profile-email"></span></div>
    <input id="profile-fullname" placeholder="Full name" />
    <textarea id="profile-bio" placeholder="Short bio"></textarea>
    <button id="btn-save-profile">Save profile</button>
    <h4>Progress Tracker</h4>
    <div id="progress-list">No quiz attempts yet.</div>
  </div>  <div id="quiz-card" class="card hidden">
    <h3>5-question Quiz</h3>
    <form id="quiz-form">
      <div class="question">
        <label>1) What is 2 + 2?</label>
        <input name="q1" required />
      </div>
      <div class="question">
        <label>2) What is the capital of France?</label>
        <input name="q2" required />
      </div>
      <div class="question">
        <label>3) Which language runs in a browser?</label>
        <input name="q3" required />
      </div>
      <div class="question">
        <label>4) What does HTML stand for?</label>
        <input name="q4" required />
      </div>
      <div class="question">
        <label>5) What does CSS control?</label>
        <input name="q5" required />
      </div>
      <button type="submit">Submit Quiz</button>
    </form>
    <div id="quiz-result"></div>
  </div>  <script type="module">
  // ✅ Import Firebase modules
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js'
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    signOut,
    onAuthStateChanged
  } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js'
  import {
    getFirestore,
    doc,
    setDoc,
    getDoc,
    updateDoc,
    arrayUnion
  } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js'

  // ✅ Your Firebase project configuration
  const firebaseConfig = {
    apiKey: "AIzaSyC8f3gqbODwvPchCq59NvfSdyhe2TouMzs",
    authDomain: "sample-1aac6.firebaseapp.com",
    projectId: "sample-1aac6",
    storageBucket: "sample-1aac6.appspot.com",
    messagingSenderId: "786606982856",
    appId: "1:786606982856:web:22a4e402fa4c3ef68a87fd",
    measurementId: "G-3SHKTQXM0D"
  };

  // ✅ Initialize Firebase
  const app = initializeApp(firebaseConfig)
  const auth = getAuth(app)
  const db = getFirestore(app)

  // -----------------------
  // Your existing app logic
  // -----------------------

  const btnShowRegister = document.getElementById('btn-show-register')
  const btnShowLogin = document.getElementById('btn-show-login')
  const btnShowProfile = document.getElementById('btn-show-profile')
  const btnShowQuiz = document.getElementById('btn-show-quiz')
  const btnLogout = document.getElementById('btn-logout')

  const registerCard = document.getElementById('register-card')
  const loginCard = document.getElementById('login-card')
  const profileCard = document.getElementById('profile-card')
  const quizCard = document.getElementById('quiz-card')

  const regEmail = document.getElementById('reg-email')
  const regPassword = document.getElementById('reg-password')
  const regName = document.getElementById('reg-name')
  const regMsg = document.getElementById('reg-msg')
  const btnRegister = document.getElementById('btn-register')

  const loginEmail = document.getElementById('login-email')
  const loginPassword = document.getElementById('login-password')
  const loginMsg = document.getElementById('login-msg')
  const btnLogin = document.getElementById('btn-login')

  const profileEmail = document.getElementById('profile-email')
  const profileFullname = document.getElementById('profile-fullname')
  const profileBio = document.getElementById('profile-bio')
  const btnSaveProfile = document.getElementById('btn-save-profile')
  const progressList = document.getElementById('progress-list')

  const quizForm = document.getElementById('quiz-form')
  const quizResult = document.getElementById('quiz-result')

  function show(elem){ elem.classList.remove('hidden') }
  function hide(elem){ elem.classList.add('hidden') }
  function showOnly(...elems){ [registerCard, loginCard, profileCard, quizCard].forEach(e=>hide(e)); elems.forEach(e=>show(e)) }

  btnShowRegister.addEventListener('click', ()=> showOnly(registerCard))
  btnShowLogin.addEventListener('click', ()=> showOnly(loginCard))
  btnShowProfile.addEventListener('click', ()=> showOnly(profileCard))
  btnShowQuiz.addEventListener('click', ()=> showOnly(quizCard))

  // Register new user
  btnRegister.addEventListener('click', async () => {
    regMsg.textContent = ''
    const email = regEmail.value.trim()
    const password = regPassword.value
    const name = regName.value.trim() || 'Anonymous'
    try {
      const userCred = await createUserWithEmailAndPassword(auth, email, password)
      const uid = userCred.user.uid
      await setDoc(doc(db, 'users', uid), {
        email,
        fullname: name,
        bio: '',
        quizAttempts: []
      })
      regMsg.textContent = 'Account created — you are logged in.'
    } catch(err) {
      regMsg.textContent = 'Error: ' + err.message
    }
  })

  // Login
  btnLogin.addEventListener('click', async ()=>{
    loginMsg.textContent = ''
    const email = loginEmail.value.trim()
    const password = loginPassword.value
    try {
      await signInWithEmailAndPassword(auth, email, password)
      loginMsg.textContent = 'Logged in.'
    } catch(err){
      loginMsg.textContent = 'Error: ' + err.message
    }
  })

  // Logout
  btnLogout.addEventListener('click', async ()=> await signOut(auth))

  // Save profile
  btnSaveProfile.addEventListener('click', async ()=>{
    const fullname = profileFullname.value.trim()
    const bio = profileBio.value.trim()
    const user = auth.currentUser
    if(!user) return alert('Not signed in')
    try{
      await updateDoc(doc(db, 'users', user.uid), { fullname, bio })
      alert('Profile saved')
      loadProfile(user.uid)
    }catch(err){ alert('Error: '+err.message) }
  })

  const correctAnswers = {
    q1: '4',
    q2: 'paris',
    q3: 'javascript',
    q4: 'hyper text markup language',
    q5: 'styling'
  }

  quizForm.addEventListener('submit', async (e)=>{
    e.preventDefault()
    const form = new FormData(quizForm)
    let score = 0
    const answers = {}
    for(const [k,v] of form.entries()){
      answers[k] = v.trim().toLowerCase()
      if(answers[k] === correctAnswers[k]) score++
    }
    quizResult.textContent = `You scored ${score}/5`
    const user = auth.currentUser
    if(!user){ quizResult.textContent += ' — score not saved (not logged in)'; return }
    const attempt = { ts: new Date().toISOString(), score, answers }
    try{
      await updateDoc(doc(db, 'users', user.uid), { quizAttempts: arrayUnion(attempt) })
      quizResult.textContent += ' — saved to your progress tracker.'
      loadProfile(user.uid)
    }catch(err){ quizResult.textContent += ' — error saving: '+err.message }
  })

  async function loadProfile(uid){
    const snap = await getDoc(doc(db, 'users', uid))
    if(!snap.exists()) return
    const data = snap.data()
    profileEmail.textContent = data.email || ''
    profileFullname.value = data.fullname || ''
    profileBio.value = data.bio || ''
    const attempts = data.quizAttempts || []
    if(attempts.length === 0){
      progressList.textContent = 'No quiz attempts yet.'
      return
    }
    progressList.innerHTML = attempts.map(a =>
      `<div style="border-bottom:1px solid #eee; padding:6px 0">
        <strong>${new Date(a.ts).toLocaleString()}</strong> — Score: ${a.score}/5
      </div>`).join('')
  }

  // Listen for auth state changes
  onAuthStateChanged(auth, async user => {
    if(user){
      btnShowProfile.classList.remove('hidden')
      btnShowQuiz.classList.remove('hidden')
      btnLogout.classList.remove('hidden')
      btnShowRegister.classList.add('hidden')
      btnShowLogin.classList.add('hidden')
      await loadProfile(user.uid)
      showOnly(profileCard)
    } else {
      btnShowProfile.classList.add('hidden')
      btnShowQuiz.classList.add('hidden')
      btnLogout.classList.add('hidden')
      btnShowRegister.classList.remove('hidden')
      btnShowLogin.classList.remove('hidden')
      showOnly(registerCard)
    }
  })
</script>

</body>
</html>

